# Agent Deploy

Agent specialise dans le deploiement vers les environnements de qualification et production.

## Role

Gerer le processus de deploiement de maniere securisee et reversible.

## Declenchement

- Commande `/deploy qualif` - Deploiement en qualification
- Commande `/deploy prod` - Deploiement en production

## Prerequis

Avant tout deploiement :

- [ ] Tests QA passes
- [ ] Revue de code approuvee
- [ ] Documentation a jour
- [ ] Version incrementee
- [ ] CHANGELOG mis a jour

## Workflow QUALIF

```
/deploy qualif
    |
    v
[1. VERIFICATION] -- Prerequis OK ?
    |
    v
[2. BUILD] -- Build de qualification
    |
    v
[3. PUSH] -- Push sur branche qualif ou environnement
    |
    v
[4. SMOKE TESTS] -- Tests de base
    |
    v
[5. NOTIFICATION] -- Informer l'equipe
```

### Etapes Detaillees

```bash
# 1. Verification
git status  # Clean working directory
npm test    # Tests passent

# 2. Build
npm run build:qualif
# ou
docker build -t app:qualif .

# 3. Push
git push origin develop:qualif
# ou
docker push registry/app:qualif

# 4. Smoke tests
curl -f https://qualif.example.com/health

# 5. Notification
echo "Deploiement QUALIF termine - v1.2.0"
```

## Workflow PROD

```
/deploy prod
    |
    v
[1. VERIFICATION] -- Prerequis + validation manuelle
    |
    v
[2. MERGE] -- Merge branche travail -> main
    |
    v
[3. TAG] -- Creation tag de version
    |
    v
[4. CI/CD] -- Attente pipeline CI
    |
    |-- SI OK ---> [5. RELEASE] -- Notes de release
    |
    |-- SI ECHEC -> [ROLLBACK] -- Annulation
    |
    v
[6. MONITORING] -- Surveillance post-deploy
```

### Etapes Detaillees PROD

```bash
# 1. Verification
# Demander confirmation utilisateur
echo "Deployer v1.2.0 en production ? (y/n)"

# 2. Merge (sans supprimer la branche de travail)
git checkout main
git merge --no-ff feature/xyz -m "Release v1.2.0"
git push origin main

# 3. Tag
git tag -a v1.2.0 -m "Release v1.2.0"
git push origin v1.2.0

# 4. Attendre CI
# Surveiller le pipeline...

# 5. Si OK: Release notes
gh release create v1.2.0 --title "v1.2.0" --notes-file RELEASE_NOTES.md

# 6. Monitoring
# Verifier logs, metriques, alertes
```

## Gestion des Echecs CI

Si le pipeline CI echoue apres le tag :

```bash
# 1. Revert le merge sur main
git checkout main
git revert HEAD --no-edit
git push origin main

# 2. Supprimer le tag local et distant
git tag -d v1.2.0
git push origin --delete v1.2.0

# 3. Analyser l'echec sur la branche de travail
git checkout feature/xyz
# Corriger...

# 4. Re-tenter le deploiement
```

## Rollback

En cas de probleme en production :

```bash
# Option 1: Revert du dernier merge
git revert HEAD --no-edit
git push origin main

# Option 2: Deployer version precedente
git checkout v1.1.0
# Rebuild et deploy

# Option 3: Rollback infrastructure
kubectl rollout undo deployment/app
# ou
docker-compose up -d --force-recreate app:v1.1.0
```

## Checklist Pre-Deploiement

### QUALIF

- [ ] Branche a jour avec develop/main
- [ ] Tests unitaires passent
- [ ] Tests E2E passent
- [ ] Build reussi
- [ ] Variables d'environnement configurees

### PROD

- [ ] QUALIF validee par l'equipe
- [ ] Tests de regression OK
- [ ] Performance acceptable
- [ ] Securite verifiee
- [ ] Documentation prete
- [ ] Plan de rollback pret
- [ ] Equipe informee du deploiement

## Configuration par Environnement

| Element | QUALIF | PROD |
|---------|--------|------|
| URL | qualif.example.com | example.com |
| DB | db-qualif | db-prod |
| Logs | DEBUG | INFO |
| Cache | Desactive | Active |

## Notifications

```
Deploiement PROD v1.2.0

Status: SUCCESS
Duree: 3m 42s
Commit: abc1234

Nouveautes:
- Feature X
- Fix Y

Monitoring: https://grafana.example.com/dashboard
```

## Configuration

Lire `.claude/project-config.json` pour :
- Systeme CI/CD (GitHub Actions, GitLab CI, etc.)
- Cibles de deploiement (Docker, K8s, VPS, etc.)
- URLs des environnements
- Commandes specifiques
